---
title: "MigrAnglR"
author: "Pierre Osteil"
date: "26/04/2024"
output: html_document
toc: TRUE
---

# Packages

```{r}
library(tidyverse)
```



# Design of the fonction

This function calculates the angle in degrees between two vectors by taking the dot product of the vectors, dividing it by the product of their magnitudes, and then taking the arccosine of the result. The acros function retunrs  the inverse of the cosine function. It returns the angle in radians whose cosine is the specified value.

Î¸ = cos-1 [ (a. b) / (||a|| * ||b||) ] 

where ||x|| is the magnitude of a vector which is the square root of the sum of the squares of the elements of the vector.

https://www.youtube.com/watch?v=dYPRYO8QhxU

```{r}
angle_between_vectors <- function(v1, v2) {
  dot_product <- sum(v1 * v2)
  magnitude_v1 <- sqrt(sum(v1^2))
  magnitude_v2 <- sqrt(sum(v2^2))
  angle <- acos(dot_product / (magnitude_v1 * magnitude_v2))
  angle_in_degrees <- angle * (180 / pi)
  return(angle_in_degrees)
}

# Example usage
vector1 <- c(3, 4, 5)
vector2 <- c(1, 2, 2)
angle_between_vectors(vector1, vector2)

```

# Test with data from ImageJ
## open the data file
```{r}
dir <- getwd()
listFiles <- list.files(file.path(dir, "data/"))

# need a for loop opening files.
angleDat <- data.frame()

for (i in 1:length(listFiles)) {
temp <- read.csv(file.path(dir, "data/", listFiles[1]), h= TRUE, sep = ";")
metadata_fileName <- strsplit(listFiles[1], "_")
temp$date <- strsplit(metadata_fileName[[1]][1], " ")[[1]][4]
temp$ID_Embryon <- as.numeric(strsplit(strsplit(metadata_fileName[[1]][4], "-")[[1]][2], ".", fixed = T)[[1]][1])
temp$unique_ID_Embryon <- paste0(temp$date, "_", temp$ID_Embryon) # metadata on embryo name
angleDat <- rbind.data.frame(angleDat, temp)
}
dim(angleDat)
head(angleDat)
```

## metadata on cells to vector1

```{r}
angleDat_meta <- str_split_fixed(angleDat$Name, pattern = "_", n = 4)
head(angleDat_meta)


colnames(angleDat_meta) <- c("ID_Omero", "CellType", "cellNumber", "CentreName")
angleDat_complete <- cbind.data.frame(angleDat, angleDat_meta)

head(angleDat_complete)
```

## calulcate the angle between vectors

from coordinates of 4 points 2 in the TE and 2 in the PE, I will construct a vector for each and calculate the angle.   
```{r}

test <- angleDat_complete |> filter(unique_ID_Embryon == "20220516_1" & cellNumber == 1)



TE_vec <- c(X_TEN2, Y_TEN2, Z_TEN2) - c(X_TEN1, Y_TEN1, Z_TEN1) # TE1 N2 - TE1 N1
PE_vec <- c(X_PEC, Y_PEC, Z_PEC) - c(X_PEN, Y_PEN, Z_PEN) # PE C - PE N


angle_between_vectors(TE_vec, PE_vec)

```